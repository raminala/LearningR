---
title: Reshaping Data with tidyr
author: ''
date: '2021-10-04'
slug: reshaping-data-with-tidyr
categories: []
tags:
  - data_wrangling
  - dataset_preparation
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>


<p>Data in the wild can be scary—when confronted with a complicated and messy dataset you may find yourself wondering, where do I even start? The tidyr package allows you to wrangle such beasts into nice and tidy datasets. Inaccessible values stored in column names will be put into rows, JSON files will become data frames, and missing values will never go missing again. You’ll practice these techniques on a wide range of messy datasets, learning along the way how many dogs the Soviet Union sent into space and what bird is most popular in New Zealand. With the tidyr package in your tidyverse toolkit, you’ll be able to transform almost any dataset in a tidy format which will pay-off during the rest of your analysis.</p>
<div id="tidy-data" class="section level2">
<h2>1- Tidy data</h2>
<p>You’ll be introduced to the concept of tidy data which is central to this course. In the first two lessons, you’ll jump straight into the action by separating messy character columns into tidy variables and observations ready for analysis. In the final lesson, you’ll learn how to overwrite and remove missing values.</p>
</div>
<div id="multiple-variables-per-column" class="section level2">
<h2>1-3 Multiple variables per column</h2>
<p>Being a busy person, you don’t want to spend too much time on Netflix, so you decide to crunch some numbers on TV show and movie durations before deciding what to watch. You’ve managed to obtain a dataset named netflix_df, but its duration column has an issue. It contains strings with both a value and unit of duration (“min” or “Season”).</p>
<p>You’ll tidy this dataset so that each variable gets its own column.</p>
<pre class="r"><code>netflix_df %&gt;% 
  # Split the duration column into value and unit columns
  separate(duration, into = c(&quot;value&quot;, &quot;unit&quot;), sep = &quot; &quot;, convert = TRUE)</code></pre>
<pre><code>## # A tibble: 637 x 4
##    title                  type    value unit  
##    &lt;chr&gt;                  &lt;chr&gt;   &lt;int&gt; &lt;chr&gt; 
##  1 Article 15             Movie     125 min   
##  2 Kill Me If You Dare    Movie     100 min   
##  3 The Spy                TV Show     1 Season
##  4 The World We Make      Movie     108 min   
##  5 Watchman               Movie      93 min   
##  6 Mo Gilligan: Momentum  Movie      64 min   
##  7 Domino                 Movie      89 min   
##  8 TUNA GIRL              Movie      90 min   
##  9 Bard of Blood          TV Show     1 Season
## 10 Dragons: Rescue Riders TV Show     1 Season
## # ... with 627 more rows</code></pre>
</div>
<div id="international-phone-numbers" class="section level2">
<h2>1-5 International phone numbers</h2>
<p>You work for a multinational company that uses auto-dialer software to contact its customers. When new customers subscribe online they are asked for a phone number but they often forget to add the country code needed for international calls. You were asked to fix this issue in the database. You’ve been given a data frame with national numbers and country codes named phone_nr_df. Now you want to combine the country_code and national_number columns to create valid international numbers.</p>
<pre class="r"><code>phone_nr_df</code></pre>
<pre><code>## # A tibble: 6 x 3
##   country        country_code national_number
##   &lt;chr&gt;                 &lt;dbl&gt;           &lt;dbl&gt;
## 1 USA                       1      2025550117
## 2 United Kingdom           44      1632960924
## 3 Brazil                   55     95552452220
## 4 Australia                61      1900654321
## 5 China                    86     13555953217
## 6 India                    91      8555843898</code></pre>
<pre class="r"><code>phone_nr_df %&gt;%
  # Unite the country_code and national_number columns
  unite(&quot;international_number&quot;, country_code, national_number, sep = &quot; &quot;)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   country        international_number
##   &lt;chr&gt;          &lt;chr&gt;               
## 1 USA            1 2025550117        
## 2 United Kingdom 44 1632960924       
## 3 Brazil         55 95552452220      
## 4 Australia      61 1900654321       
## 5 China          86 13555953217      
## 6 India          91 8555843898</code></pre>
</div>
<div id="extracting-observations-from-values" class="section level2">
<h2>1-6 Extracting observations from values</h2>
<p>You’re given a sample of the Netflix dataset containing TV shows and their casts called tvshow_df. You want to learn which six actors have the most appearances.</p>
<p>However, the dataset only has one row per TV show, and multiple actors are listed in the cast column.</p>
<p>Transform the data so that for each TV show, every actor has a row. The number of appearances will be calculated for you.</p>
<pre class="r"><code>tvshow_df</code></pre>
<pre><code>## # A tibble: 1,759 x 2
##    title                   cast                                                 
##    &lt;chr&gt;                   &lt;chr&gt;                                                
##  1 Transformers Prime      Peter Cullen, Sumalee Montano, Frank Welker, Jeffrey~
##  2 Transformers: Robots i~ Will Friedle, Darren Criss, Constance Zimmer, Khary ~
##  3 Apaches                 Alberto Ammann, Eloy Azorín, Verónica Echegui, Lucía~
##  4 Castle of Stars         Chaiyapol Pupart, Jintanutda Lummakanon, Worrawech D~
##  5 Archibald&#39;s Next Big T~ Tony Hale, Rosamund Pike, Jordan Fisher, Chelsea Kan~
##  6 The Spy                 Sacha Baron Cohen, Noah Emmerich, Hadar Ratzon Rotem~
##  7 No Tomorrow             Joshua Sasse, Tori Anderson, Jonathan Langdon, Saray~
##  8 Frequency               Peyton List, Riley Smith, Mekhi Phifer, Devin Kelley~
##  9 Adam Ruins Everything   Adam Conover, Adam Lustick, Emily Axford             
## 10 Ben 10                  Tara Strong, Montse Hernandez, David Kaye, Roger Cra~
## # ... with 1,749 more rows</code></pre>
<pre class="r"><code>tvshow_df %&gt;% 
  # Separate the actors in the cast column over multiple rows
  separate_rows(cast, sep = &quot;, &quot;, convert = TRUE) %&gt;% 
  rename(actor = cast) %&gt;% 
  count(actor, sort = TRUE) %&gt;% 
  head()</code></pre>
<pre><code>## # A tibble: 6 x 2
##   actor                  n
##   &lt;chr&gt;              &lt;int&gt;
## 1 Takahiro Sakurai      18
## 2 Yuki Kaji             16
## 3 Daisuke Ono           14
## 4 David Attenborough    14
## 5 Ashleigh Ball         12
## 6 Hiroshi Kamiya        12</code></pre>
</div>
<div id="separating-into-columns-and-rows" class="section level2">
<h2>1-7 Separating into columns and rows</h2>
<p>Remember the drink ingredients data from the video? You’ve been given an similar version (drink_df) that also includes quantities and units. Now you want to create an overview of how much of each ingredient you should buy to make these drinks.</p>
<pre class="r"><code>drink_df</code></pre>
<pre><code>## # A tibble: 3 x 2
##   drink          ingredients                                    
##   &lt;chr&gt;          &lt;chr&gt;                                          
## 1 Chocolate milk milk 0.3 L; chocolate 40 g; sugar 10 g         
## 2 Orange juice   oranges 3; sugar 20 g                          
## 3 Cappuccino     milk 0.1 L; water 0.1 L; coffee 30 g; sugar 5 g</code></pre>
<pre class="r"><code>drink_df %&gt;% 
  # Separate the ingredients over rows
  separate_rows(ingredients, sep = &quot;; &quot;) %&gt;% 
  # Separate ingredients into three columns
  separate(
    ingredients, 
    into = c(&quot;ingredient&quot;, &quot;quantity&quot;, &quot;unit&quot;), 
    sep = &quot; &quot;, 
    convert = TRUE
  ) %&gt;% 
  # Group by ingredient and unit
  group_by(ingredient, unit) %&gt;% 
  # Calculate the total quantity of each ingredient
  summarize(quantity = sum(quantity))</code></pre>
<pre><code>## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [4].</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;ingredient&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 6 x 3
## # Groups:   ingredient [6]
##   ingredient unit  quantity
##   &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt;
## 1 chocolate  g         40  
## 2 coffee     g         30  
## 3 milk       L          0.4
## 4 oranges    &lt;NA&gt;       3  
## 5 sugar      g         35  
## 6 water      L          0.1</code></pre>
</div>
<div id="and-the-oscar-for-best-director-goes-to" class="section level2">
<h2>1-9 And the Oscar for best director goes to … <NA></h2>
<p>You’re working on a sample of the Netflix dataset pre-loaded as director_df. This time, the data frame contains just the directors and movie titles. Your goal is to identify the directors who created the most movies. Since the director column contains multiple names, you’ll first separate its values over multiple rows and then count the directors.</p>
<p>Since you don’t want movies without directors polluting your overview, you’ll apply the drop_na() function.</p>
<pre class="r"><code>director_df %&gt;% 
  # Spread the director column over separate rows
  separate_rows(director, sep = &quot;, &quot;) %&gt;% 
  # Count the number of movies per director
  count(director, sort=TRUE)</code></pre>
<pre><code>## # A tibble: 3,536 x 2
##    director             n
##    &lt;chr&gt;            &lt;int&gt;
##  1 &lt;NA&gt;               129
##  2 Jan Suter           21
##  3 Raúl Campos         19
##  4 Jay Karas           14
##  5 Marcus Raboy        14
##  6 Jay Chapman         12
##  7 Martin Scorsese      9
##  8 Steven Spielberg     9
##  9 David Dhawan         8
## 10 Johnnie To           8
## # ... with 3,526 more rows</code></pre>
<pre class="r"><code>director_df %&gt;% 
  # Drop rows with NA values in the director column
  drop_na() %&gt;% 
  # Spread the director column over separate rows
  separate_rows(director, sep = &quot;, &quot;) %&gt;% 
  # Count the number of movies per director
  count(director, sort = TRUE)</code></pre>
<pre><code>## # A tibble: 3,535 x 2
##    director             n
##    &lt;chr&gt;            &lt;int&gt;
##  1 Jan Suter           21
##  2 Raúl Campos         19
##  3 Jay Karas           14
##  4 Marcus Raboy        14
##  5 Jay Chapman         12
##  6 Martin Scorsese      9
##  7 Steven Spielberg     9
##  8 David Dhawan         8
##  9 Johnnie To           8
## 10 Lance Bangs          8
## # ... with 3,525 more rows</code></pre>
</div>
<div id="imputing-sales-data" class="section level2">
<h2>1-10 Imputing sales data</h2>
<p>You’ve been asked to create a report that allows management to compare sales figures per quarter for two years. The problem is that the dataset (sales_df) contains missing values. You’ll need to impute the values in the year column so that you can visualize the data.</p>
<pre class="r"><code>sales_df %&gt;% 
  # Impute the year column
  fill(year, .direction = &quot;up&quot;) %&gt;%
  # Create a line plot with sales per quarter colored by year.
  ggplot(aes(x = quarter, y = sales, color = as.factor(year), group = year)) +
  geom_line()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="nuclear-bombs-per-continent" class="section level2">
<h2>1-11 Nuclear bombs per continent</h2>
<p>Since WWII, a number of nations have been detonating nuclear bombs for military research. A tally of bombs detonated per nation has been calculated from the Nuclear Explosion DataBase (NEDB) and provided as nuke_df. You are interested in finding out how many bombs have been detonated by nations grouped per continent. To achieve this goal, nuke_df will be joined to country_to_continent_df which is a mapping of nation to continent. You will need to overwrite missing values with zeros so that you can create a nice plot.</p>
<p>The dplyr and ggplot2 packages have been pre-loaded for you.</p>
<p>Side note 1: Bombs detonated by the Soviet Union were attributed to the Russian Federation.</p>
<p>Side note 2: The Russian Federation is solely mapped to Europe for simplicity.</p>
<pre class="r"><code>country_to_continent_df %&gt;% 
  left_join(nuke_df, by = &quot;country_code&quot;) %&gt;%  
  # Impute the missing values in the n_bombs column with 0L
  replace_na(list(n_bombs = 0L)) %&gt;% 
  # Group the dataset by continent
  group_by(continent) %&gt;% 
  # Sum the number of bombs per continent
  summarize(n_bombs_continent = sum(n_bombs)) %&gt;% 
  # Plot the number of bombs per continent
  ggplot(aes(continent, n_bombs_continent)) +
  geom_col()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="from-wide-to-long-and-back" class="section level2">
<h2>2- From wide to long and back</h2>
<p>This chapter is all about pivoting data from a wide to long format and back again using the <code>pivot_longer()</code> and <code>pivot_wider()</code> functions. You’ll need these functions when variables are hidden in messy column names or when variables are stored in rows instead of columns. You’ll learn about space dogs, nuclear bombs, and planet temperatures along the way.</p>
</div>
<div id="nuclear-bombs-per-country" class="section level2">
<h2>2-2 Nuclear bombs per country</h2>
<p>You’ve been given a version of the Nuclear Explosion DataBase (NEDB) where country names are specified in the column headers (nuke_df). You want to visualize how many nukes were detonated per year per country. You’ll need to pivot the data and replace NA values first.</p>
<pre class="r"><code>nuke_df2</code></pre>
<pre><code>## # A tibble: 73 x 9
##     year `United States` `Russian Federatio~ `United Kingdom` France China India
##    &lt;dbl&gt;           &lt;dbl&gt;               &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  1945               3                  NA               NA     NA    NA    NA
##  2  1946               2                  NA               NA     NA    NA    NA
##  3  1947              NA                  NA               NA     NA    NA    NA
##  4  1948               3                  NA               NA     NA    NA    NA
##  5  1949              NA                   1               NA     NA    NA    NA
##  6  1950              NA                  NA               NA     NA    NA    NA
##  7  1951              16                   2               NA     NA    NA    NA
##  8  1952              10                  NA                1     NA    NA    NA
##  9  1953              11                   5                2     NA    NA    NA
## 10  1954               6                  10               NA     NA    NA    NA
## # ... with 63 more rows, and 2 more variables: Pakistan &lt;dbl&gt;,
## #   North Korea &lt;dbl&gt;</code></pre>
<pre class="r"><code>nuke_df2 %&gt;% 
  # Pivot the data to a longer format
  pivot_longer(-year)</code></pre>
<pre><code>## # A tibble: 584 x 3
##     year name               value
##    &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
##  1  1945 United States          3
##  2  1945 Russian Federation    NA
##  3  1945 United Kingdom        NA
##  4  1945 France                NA
##  5  1945 China                 NA
##  6  1945 India                 NA
##  7  1945 Pakistan              NA
##  8  1945 North Korea           NA
##  9  1946 United States          2
## 10  1946 Russian Federation    NA
## # ... with 574 more rows</code></pre>
<pre class="r"><code>nuke_df2 %&gt;% 
  # Pivot the data to a longer format
  pivot_longer(
    -year, 
    # Overwrite the names of the two new columns
    names_to = &quot;country&quot;, 
     values_to = &quot;n_bombs&quot;
  ) </code></pre>
<pre><code>## # A tibble: 584 x 3
##     year country            n_bombs
##    &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;
##  1  1945 United States            3
##  2  1945 Russian Federation      NA
##  3  1945 United Kingdom          NA
##  4  1945 France                  NA
##  5  1945 China                   NA
##  6  1945 India                   NA
##  7  1945 Pakistan                NA
##  8  1945 North Korea             NA
##  9  1946 United States            2
## 10  1946 Russian Federation      NA
## # ... with 574 more rows</code></pre>
<pre class="r"><code>nuke_df2 %&gt;% 
  # Pivot the data to a longer format
  pivot_longer(
    -year, 
    # Overwrite the names of the two new columns
    names_to = &quot;country&quot;, 
    values_to = &quot;n_bombs&quot;
  ) %&gt;%
  # Replace NA values for n_bombs with 0L
   replace_na(list(n_bombs = 0L))</code></pre>
<pre><code>## # A tibble: 584 x 3
##     year country            n_bombs
##    &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;
##  1  1945 United States            3
##  2  1945 Russian Federation       0
##  3  1945 United Kingdom           0
##  4  1945 France                   0
##  5  1945 China                    0
##  6  1945 India                    0
##  7  1945 Pakistan                 0
##  8  1945 North Korea              0
##  9  1946 United States            2
## 10  1946 Russian Federation       0
## # ... with 574 more rows</code></pre>
<pre class="r"><code>nuke_df2 %&gt;% 
  # Pivot the data to a longer format
  pivot_longer(
    -year, 
    # Overwrite the names of the two new columns
    names_to = &quot;country&quot;, 
    values_to = &quot;n_bombs&quot;
  ) %&gt;% 
  # Replace NA values for n_bombs with 0L
  replace_na(list(n_bombs = 0L)) %&gt;% 
  # Plot the number of bombs per country over time
  ggplot(aes(year,n_bombs, color=country)) +
  geom_line()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="who-obesity-per-country" class="section level2">
<h2>2-3 WHO obesity per country</h2>
<p>According to the World Health Organization (WHO), worldwide obesity has nearly tripled since 1975. You’re interested in the severity of this global health issue per country and whether males and females are affected differently. You’ll use the WHO’s obesity data (obesity_df) to investigate this issue. The data holds the percentage of females, males, and both sexes combined that are considered obese (BMI &gt; 30) per country.</p>
<p>You want to create a scatterplot where, per nation, you can see the obesity data colored differently for females and males. This implies that sex should become a variable with its own column.</p>
<pre class="r"><code>obesity_df</code></pre>
<pre><code>## # A tibble: 190 x 4
##    country              male female both_sexes
##    &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
##  1 Afghanistan           3.2    7.6        5.5
##  2 Albania              21.6   21.8       21.7
##  3 Algeria              19.9   34.9       27.4
##  4 Andorra              25.9   25.3       25.6
##  5 Angola                4     12.1        8.2
##  6 Antigua and Barbuda  11.6   25.9       18.9
##  7 Argentina            27.3   29         28.3
##  8 Armenia              17.1   23         20.2
##  9 Australia            29.6   28.4       29  
## 10 Austria              21.9   18.3       20.1
## # ... with 180 more rows</code></pre>
<pre class="r"><code>obesity_df %&gt;% 
  # Pivot the male and female columns
  pivot_longer(c(male,female), names_to = &quot;sex&quot;, 
    values_to = &quot;pct_obese&quot;)</code></pre>
<pre><code>## # A tibble: 380 x 4
##    country     both_sexes sex    pct_obese
##    &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 Afghanistan        5.5 male         3.2
##  2 Afghanistan        5.5 female       7.6
##  3 Albania           21.7 male        21.6
##  4 Albania           21.7 female      21.8
##  5 Algeria           27.4 male        19.9
##  6 Algeria           27.4 female      34.9
##  7 Andorra           25.6 male        25.9
##  8 Andorra           25.6 female      25.3
##  9 Angola             8.2 male         4  
## 10 Angola             8.2 female      12.1
## # ... with 370 more rows</code></pre>
<pre class="r"><code>obesity_df %&gt;% 
  # Pivot the male and female columns
  pivot_longer(c(male, female),
               names_to = &quot;sex&quot;,
               values_to = &quot;pct_obese&quot;) %&gt;% 
  # Create a scatter plot with pct_obese per country colored by sex
  ggplot(aes(x = pct_obese, color = sex,
             y = forcats::fct_reorder(country, both_sexes))) +
  geom_point() +
  scale_y_discrete(breaks = c(&quot;India&quot;, &quot;Nauru&quot;, &quot;Cuba&quot;, &quot;Brazil&quot;,
                              &quot;Pakistan&quot;, &quot;Gabon&quot;, &quot;Italy&quot;, &quot;Oman&quot;,
                              &quot;China&quot;, &quot;United States of America&quot;)) +
  labs(x = &quot;% Obese&quot;, y = &quot;Country&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="bond-james-bond" class="section level2">
<h2>2-4 Bond… James Bond</h2>
<p>You’ve been given a James Bond movie dataset (bond_df) and want to visualize the number of movies that Bond actors have featured in per decade. However, the data is in an untidy format with the decade values captured in the column headers. You’ll tidy this dataset to give each variable its own column.</p>
<pre class="r"><code>bond_df %&gt;% 
  # Pivot the data to long format
  pivot_longer(
    -Bond, 
    # Overwrite the names of the two newly created columns
    names_to = &quot;decade&quot;, 
    values_to = &quot;n_movies&quot;, 
    # Drop na values
    values_drop_na = TRUE, 
    # Transform the decade column data type to integer
   names_transform= list(decade = as.integer)
  ) %&gt;% 
  ggplot(aes(x = decade + 5, y = n_movies, fill = Bond))+
  geom_col()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="new-zealands-bird-of-the-year" class="section level2">
<h2>2-6 New-Zealand’s bird of the year</h2>
<p>Every year New Zealanders vote en masse to decide which species gets the bird of the year trophy. The contest is organized by the Forest &amp; Bird agency which allows each person to give points to up to five birds (first pick gets 5 points, second 4, …). Your job is to decide this year’s winner from the messy dataset that’s been pre-loaded for you as bird_df.</p>
<pre class="r"><code>bird_df</code></pre>
<pre><code>## # A tibble: 10,000 x 5
##    points_5          points_4      points_3        points_2        points_1     
##    &lt;chr&gt;             &lt;chr&gt;         &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt;        
##  1 Yellow-eyed peng~ Kea           Tui             Southern Royal~ Southern Bro~
##  2 Yellow-eyed peng~ Kereru        Tui             Saddleback      Rockhopper P~
##  3 Fiordland Creste~ Bar-tailed G~ Banded Dotterel Black Robin     Blue Duck    
##  4 Fantail           Kea           Tui             Kaka            Kakapo       
##  5 Kakapo            Little Spott~ Rockhopper Pen~ Kokako          Shore Plover 
##  6 Yellow-eyed peng~ &lt;NA&gt;          &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;         
##  7 Kakapo            Black Robin   Orange-fronted~ Little Spotted~ Kaka         
##  8 Australasian Cre~ Blue Duck     New Zealand Fa~ Tomtit          Kea          
##  9 Antipodean Albat~ Southern Bro~ Southern Royal~ Great Spotted ~ Barn Owl     
## 10 Kereru            Rockhopper P~ Royal Spoonbill Little Spotted~ Yellow-eyed ~
## # ... with 9,990 more rows</code></pre>
<pre class="r"><code>bird_df %&gt;%
  # Pivot the data to create a two column data frame
  pivot_longer(
    c(points_1, points_2, points_3, points_4, points_5),
    names_to = &quot;points&quot;,
    names_prefix = &quot;points_&quot;,
    names_transform = list(points = as.integer),
    values_to = &quot;species&quot;,
    values_drop_na = TRUE
  )</code></pre>
<pre><code>## # A tibble: 46,808 x 2
##    points species                 
##     &lt;int&gt; &lt;chr&gt;                   
##  1      1 Southern Brown Kiwi     
##  2      2 Southern Royal Albatross
##  3      3 Tui                     
##  4      4 Kea                     
##  5      5 Yellow-eyed penguin     
##  6      1 Rockhopper Penguin      
##  7      2 Saddleback              
##  8      3 Tui                     
##  9      4 Kereru                  
## 10      5 Yellow-eyed penguin     
## # ... with 46,798 more rows</code></pre>
<p>Alternative solution…</p>
<pre class="r"><code>bird_df %&gt;%
  # Pivot the data to create a two column data frame
  pivot_longer(
     starts_with(&quot;points_&quot;),
    names_to = &quot;points&quot;,
    names_prefix = &quot;points_&quot;,
    names_transform = list(points = as.integer),
    values_to = &quot;species&quot;,
    values_drop_na = TRUE
  ) %&gt;%
  group_by(species) %&gt;% 
  summarize(total_points=sum(points)) %&gt;% 
  slice_max(total_points, n = 5)</code></pre>
<pre><code>## # A tibble: 5 x 2
##   species             total_points
##   &lt;chr&gt;                      &lt;int&gt;
## 1 Yellow-eyed penguin        13522
## 2 Kakapo                      8017
## 3 Black Robin                 6542
## 4 Banded Dotterel             5988
## 5 Kaka                        5229</code></pre>
</div>
<div id="big-tech-stock-prices" class="section level2">
<h2>2-7 Big tech stock prices</h2>
<p>You’re an analyst at an investment firm and want to visualize the weekly closing prices of five big tech firms’ stocks. However, the dataset you’ve been handed (stock_df) is messy and has the year and week variables stored in the column headers. You’ll pivot this data into a tidy format, extract the variables from the headers, and create a line plot.</p>
<pre class="r"><code>stock_df</code></pre>
<pre><code>## # A tibble: 5 x 106
##   company   `2019_week1` `2019_week2` `2019_week3` `2019_week4` `2019_week5`
##   &lt;chr&gt;            &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1 Amazon          1848.        1641.        1696.        1671.        1626. 
## 2 Apple             73.4         38.1         39.2         39.4         41.6
## 3 Facebook         205.         144.         150.         149.         166. 
## 4 Google          1337.        1057.        1098.        1091.        1111. 
## 5 Microsoft        158.         103.         108.         107.         103. 
## # ... with 100 more variables: 2019_week6 &lt;dbl&gt;, 2019_week7 &lt;dbl&gt;,
## #   2019_week8 &lt;dbl&gt;, 2019_week9 &lt;dbl&gt;, 2019_week10 &lt;dbl&gt;, 2019_week11 &lt;dbl&gt;,
## #   2019_week12 &lt;dbl&gt;, 2019_week13 &lt;dbl&gt;, 2019_week14 &lt;dbl&gt;, 2019_week15 &lt;dbl&gt;,
## #   2019_week16 &lt;dbl&gt;, 2019_week17 &lt;dbl&gt;, 2019_week18 &lt;dbl&gt;, 2019_week19 &lt;dbl&gt;,
## #   2019_week20 &lt;dbl&gt;, 2019_week21 &lt;dbl&gt;, 2019_week22 &lt;dbl&gt;, 2019_week23 &lt;dbl&gt;,
## #   2019_week24 &lt;dbl&gt;, 2019_week25 &lt;dbl&gt;, 2019_week26 &lt;dbl&gt;, 2019_week27 &lt;dbl&gt;,
## #   2019_week28 &lt;dbl&gt;, 2019_week29 &lt;dbl&gt;, 2019_week30 &lt;dbl&gt;, 2019_week31 &lt;dbl&gt;,
## #   2019_week32 &lt;dbl&gt;, 2019_week33 &lt;dbl&gt;, 2019_week34 &lt;dbl&gt;, 2019_week35 &lt;dbl&gt;,
## #   2019_week36 &lt;dbl&gt;, 2019_week37 &lt;dbl&gt;, 2019_week38 &lt;dbl&gt;, 2019_week39 &lt;dbl&gt;,
## #   2019_week40 &lt;dbl&gt;, 2019_week41 &lt;dbl&gt;, 2019_week42 &lt;dbl&gt;, 2019_week43 &lt;dbl&gt;,
## #   2019_week44 &lt;dbl&gt;, 2019_week45 &lt;dbl&gt;, 2019_week46 &lt;dbl&gt;, 2019_week47 &lt;dbl&gt;,
## #   2019_week48 &lt;dbl&gt;, 2019_week49 &lt;dbl&gt;, 2019_week50 &lt;dbl&gt;, 2019_week51 &lt;dbl&gt;,
## #   2019_week52 &lt;dbl&gt;, 2020_week1 &lt;dbl&gt;, 2020_week2 &lt;dbl&gt;, 2020_week3 &lt;dbl&gt;,
## #   2020_week4 &lt;dbl&gt;, 2020_week5 &lt;dbl&gt;, 2020_week6 &lt;dbl&gt;, 2020_week7 &lt;dbl&gt;,
## #   2020_week8 &lt;dbl&gt;, 2020_week9 &lt;dbl&gt;, 2020_week10 &lt;dbl&gt;, 2020_week11 &lt;dbl&gt;,
## #   2020_week12 &lt;dbl&gt;, 2020_week13 &lt;dbl&gt;, 2020_week14 &lt;dbl&gt;, 2020_week15 &lt;dbl&gt;,
## #   2020_week16 &lt;dbl&gt;, 2020_week17 &lt;dbl&gt;, 2020_week18 &lt;dbl&gt;, 2020_week19 &lt;dbl&gt;,
## #   2020_week20 &lt;dbl&gt;, 2020_week21 &lt;dbl&gt;, 2020_week22 &lt;dbl&gt;, 2020_week23 &lt;dbl&gt;,
## #   2020_week24 &lt;dbl&gt;, 2020_week25 &lt;dbl&gt;, 2020_week26 &lt;dbl&gt;, 2020_week27 &lt;dbl&gt;,
## #   2020_week28 &lt;dbl&gt;, 2020_week29 &lt;dbl&gt;, 2020_week30 &lt;dbl&gt;, 2020_week31 &lt;dbl&gt;,
## #   2020_week32 &lt;dbl&gt;, 2020_week33 &lt;dbl&gt;, 2020_week34 &lt;dbl&gt;, 2020_week35 &lt;dbl&gt;,
## #   2020_week36 &lt;dbl&gt;, 2020_week37 &lt;dbl&gt;, 2020_week38 &lt;dbl&gt;, 2020_week39 &lt;dbl&gt;,
## #   2020_week40 &lt;dbl&gt;, 2020_week41 &lt;dbl&gt;, 2020_week42 &lt;dbl&gt;, 2020_week43 &lt;dbl&gt;,
## #   2020_week44 &lt;dbl&gt;, 2020_week45 &lt;dbl&gt;, 2020_week46 &lt;dbl&gt;, 2020_week47 &lt;dbl&gt;,
## #   2020_week48 &lt;dbl&gt;, 2020_week49 &lt;dbl&gt;, 2020_week50 &lt;dbl&gt;, 2020_week51 &lt;dbl&gt;,
## #   2020_week52 &lt;dbl&gt;, 2020_week53 &lt;dbl&gt;</code></pre>
<pre class="r"><code>ss &lt;- stock_df %&gt;% 
  # Pivot the data to create 3 new columns: year, week, price
  pivot_longer(
    -company,
    names_to = c(&quot;year&quot;, &quot;week&quot;),
    values_to = &quot;price&quot;,
    names_sep = &quot;_week&quot;,
    names_transform = list(year = as.integer, week = as.integer)
  ) 

ss</code></pre>
<pre><code>## # A tibble: 525 x 4
##    company  year  week price
##    &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1 Amazon   2019     1 1848.
##  2 Amazon   2019     2 1641.
##  3 Amazon   2019     3 1696.
##  4 Amazon   2019     4 1671.
##  5 Amazon   2019     5 1626.
##  6 Amazon   2019     6 1588.
##  7 Amazon   2019     7 1608.
##  8 Amazon   2019     8 1632.
##  9 Amazon   2019     9 1672.
## 10 Amazon   2019    10 1621.
## # ... with 515 more rows</code></pre>
<pre class="r"><code>ss %&gt;%
  # Create a line plot with price per week, color by company
  ggplot(aes(week, price, color=company)) +
  geom_line() +
  facet_grid(. ~ year)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="soviet-space-dogs-the-dog-perspective" class="section level2">
<h2>2-9 Soviet space dogs, the dog perspective</h2>
<p>You’ll be working on an pre-processed sample of the USSR space dogs database compiled by Duncan Geere and pre-loaded for you as space_dogs_df. Each of the 42 rows in this dataset represents a test rocket launch which had one or two very brave dogs on board.</p>
<p>Your goal is to reshape this dataset so that for each launch, each dog has a row.</p>
<p>The challenge is that in the column headers (name_1, name_2, gender_1, and gender_2), the part before the _ separator can point to two different variables (name and gender), while the second part always points to the dog ID (1st or 2nd dog).</p>
<p>Complete the names_to argument so that the first part of the column headers are reused.</p>
<pre class="r"><code>space_dogs_df</code></pre>
<pre><code>## # A tibble: 42 x 6
##    date    result                     name_1      name_2       gender_1 gender_2
##    &lt;chr&gt;   &lt;chr&gt;                      &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;   
##  1 2/22/1~ recovered safely after a ~ Ugolyok / ~ Veterok / B~ Male     Male    
##  2 3/25/1~ one orbit, recovered safe~ Zvezdochka  &lt;NA&gt;         Female   &lt;NA&gt;    
##  3 3/9/19~ one orbit, recovered safe~ Chernuskha  &lt;NA&gt;         Female   &lt;NA&gt;    
##  4 12/22/~ upper stage failed, dogs ~ Shutka      Kometka      Female   Female  
##  5 12/1/1~ spent one day in orbit, c~ Mushka      Pchyolka     Female   Female  
##  6 9/22/1~ recovered safely           Kusachka /~ Neva         Female   Female  
##  7 9/16/1~ recovered safely           Malyok      Palma-2      Male     Female  
##  8 8/19/1~ spent one day in orbit, r~ Belka       Strelka      Female   Female  
##  9 7/28/1~ exploded during launch, b~ Lisichka    Bars / Chai~ Female   Female  
## 10 6/24/1~ recovered safely           Kusachka /~ Snezhinka /~ Female   Female  
## # ... with 32 more rows</code></pre>
<pre class="r"><code>space_dogs_df %&gt;% 
  pivot_longer(
    # Add the columns to pivot
    name_1:gender_2,
    names_sep = &quot;_&quot;,
    # Complete the names_to argument to re-use the first part of the column headers
    names_to = c(&quot;.value&quot;, &quot;dog_id&quot;),
    # Make sure NA values are dropped
    values_drop_na = TRUE
  )</code></pre>
<pre><code>## # A tibble: 81 x 5
##    date     result                                  dog_id name           gender
##    &lt;chr&gt;    &lt;chr&gt;                                   &lt;chr&gt;  &lt;chr&gt;          &lt;chr&gt; 
##  1 2/22/19~ recovered safely after a 22-day flight  1      Ugolyok / Sne~ Male  
##  2 2/22/19~ recovered safely after a 22-day flight  2      Veterok / Bzd~ Male  
##  3 3/25/19~ one orbit, recovered safely             1      Zvezdochka     Female
##  4 3/9/1961 one orbit, recovered safely             1      Chernuskha     Female
##  5 12/22/1~ upper stage failed, dogs recovered aft~ 1      Shutka         Female
##  6 12/22/1~ upper stage failed, dogs recovered aft~ 2      Kometka        Female
##  7 12/1/19~ spent one day in orbit, capsule was de~ 1      Mushka         Female
##  8 12/1/19~ spent one day in orbit, capsule was de~ 2      Pchyolka       Female
##  9 9/22/19~ recovered safely                        1      Kusachka / Ot~ Female
## 10 9/22/19~ recovered safely                        2      Neva           Female
## # ... with 71 more rows</code></pre>
</div>
<div id="who-obesity-vs.-life-expectancy" class="section level2">
<h2>2-10 WHO obesity vs. life expectancy</h2>
<p>You’ve been given a sample of WHO data (who_df) with obesity percentages and life expectancy data per country, year, and sex. You want to visually inspect the correlation between obesity and life expectancy.</p>
<p>However, the data is very messy with four variables hidden in the column names. Each column name is made up of three parts separated by underscores: Values for the year, followed by those for sex, and then values for either pct.obese or life.exp. Since the third part of the column name string holds two variables you’ll need to use the special “.value” value in the names_to argument.</p>
<p>You’ll pivot the data into a tidy format and create the scatterplot.</p>
<pre class="r"><code>who_df</code></pre>
<pre><code>## # A tibble: 180 x 69
##    country  `2000_male_pct.o~ `2000_male_life~ `2000_female_pc~ `2000_female_li~
##    &lt;chr&gt;                &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 Afghani~               1.2             54.6              3.4             57.3
##  2 Albania               11.7             70.4             14.7             76  
##  3 Algeria               10.3             69.4             24.2             72.2
##  4 Angola                 1.4             45.2              5.6             49.5
##  5 Antigua~               6.8             69.7             18.2             75.1
##  6 Argenti~              19.1             70.2             22.1             77.7
##  7 Armenia               10.9             68.5             16.8             74.6
##  8 Austral~              19.9             77               20.5             82.3
##  9 Austria               14.3             75.3             13.5             81.2
## 10 Azerbai~               9               63.8             15.6             69  
## # ... with 170 more rows, and 64 more variables: 2001_male_pct.obese &lt;dbl&gt;,
## #   2001_male_life.exp &lt;dbl&gt;, 2001_female_pct.obese &lt;dbl&gt;,
## #   2001_female_life.exp &lt;dbl&gt;, 2002_male_pct.obese &lt;dbl&gt;,
## #   2002_male_life.exp &lt;dbl&gt;, 2002_female_pct.obese &lt;dbl&gt;,
## #   2002_female_life.exp &lt;dbl&gt;, 2003_male_pct.obese &lt;dbl&gt;,
## #   2003_male_life.exp &lt;dbl&gt;, 2003_female_pct.obese &lt;dbl&gt;,
## #   2003_female_life.exp &lt;dbl&gt;, 2004_male_pct.obese &lt;dbl&gt;,
## #   2004_male_life.exp &lt;dbl&gt;, 2004_female_pct.obese &lt;dbl&gt;,
## #   2004_female_life.exp &lt;dbl&gt;, 2005_male_pct.obese &lt;dbl&gt;,
## #   2005_male_life.exp &lt;dbl&gt;, 2005_female_pct.obese &lt;dbl&gt;,
## #   2005_female_life.exp &lt;dbl&gt;, 2006_male_pct.obese &lt;dbl&gt;,
## #   2006_male_life.exp &lt;dbl&gt;, 2006_female_pct.obese &lt;dbl&gt;,
## #   2006_female_life.exp &lt;dbl&gt;, 2007_male_pct.obese &lt;dbl&gt;,
## #   2007_male_life.exp &lt;dbl&gt;, 2007_female_pct.obese &lt;dbl&gt;,
## #   2007_female_life.exp &lt;dbl&gt;, 2008_male_pct.obese &lt;dbl&gt;,
## #   2008_male_life.exp &lt;dbl&gt;, 2008_female_pct.obese &lt;dbl&gt;,
## #   2008_female_life.exp &lt;dbl&gt;, 2009_male_pct.obese &lt;dbl&gt;,
## #   2009_male_life.exp &lt;dbl&gt;, 2009_female_pct.obese &lt;dbl&gt;,
## #   2009_female_life.exp &lt;dbl&gt;, 2010_male_pct.obese &lt;dbl&gt;,
## #   2010_male_life.exp &lt;dbl&gt;, 2010_female_pct.obese &lt;dbl&gt;,
## #   2010_female_life.exp &lt;dbl&gt;, 2011_male_pct.obese &lt;dbl&gt;,
## #   2011_male_life.exp &lt;dbl&gt;, 2011_female_pct.obese &lt;dbl&gt;,
## #   2011_female_life.exp &lt;dbl&gt;, 2012_male_pct.obese &lt;dbl&gt;,
## #   2012_male_life.exp &lt;dbl&gt;, 2012_female_pct.obese &lt;dbl&gt;,
## #   2012_female_life.exp &lt;dbl&gt;, 2013_male_pct.obese &lt;dbl&gt;,
## #   2013_male_life.exp &lt;dbl&gt;, 2013_female_pct.obese &lt;dbl&gt;,
## #   2013_female_life.exp &lt;dbl&gt;, 2014_male_pct.obese &lt;dbl&gt;,
## #   2014_male_life.exp &lt;dbl&gt;, 2014_female_pct.obese &lt;dbl&gt;,
## #   2014_female_life.exp &lt;dbl&gt;, 2015_male_pct.obese &lt;dbl&gt;,
## #   2015_male_life.exp &lt;dbl&gt;, 2015_female_pct.obese &lt;dbl&gt;,
## #   2015_female_life.exp &lt;dbl&gt;, 2016_male_pct.obese &lt;dbl&gt;,
## #   2016_male_life.exp &lt;dbl&gt;, 2016_female_pct.obese &lt;dbl&gt;,
## #   2016_female_life.exp &lt;dbl&gt;</code></pre>
<pre class="r"><code>who_df %&gt;% 
  # Put each variable in its own column
  pivot_longer(
    -country,
    names_to = c(&quot;year&quot;, &quot;sex&quot;, &quot;.value&quot;),
    names_sep = &quot;_&quot;, 
    names_transform = list(&quot;year&quot; = as.integer)
  )</code></pre>
<pre><code>## # A tibble: 6,120 x 5
##    country      year sex    pct.obese life.exp
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1 Afghanistan  2000 male         1.2     54.6
##  2 Afghanistan  2000 female       3.4     57.3
##  3 Afghanistan  2001 male         1.3     55.3
##  4 Afghanistan  2001 female       3.6     57.9
##  5 Afghanistan  2002 male         1.3     56.5
##  6 Afghanistan  2002 female       3.8     58.5
##  7 Afghanistan  2003 male         1.4     56.9
##  8 Afghanistan  2003 female       4       59.1
##  9 Afghanistan  2004 male         1.5     57.4
## 10 Afghanistan  2004 female       4.2     59.6
## # ... with 6,110 more rows</code></pre>
<pre class="r"><code>who_df %&gt;% 
  # Put each variable in its own column
  pivot_longer(
    -country,
    names_to = c(&quot;year&quot;, &quot;sex&quot;, &quot;.value&quot;),
    names_sep = &quot;_&quot;, 
    names_transform = list(&quot;year&quot; = as.integer)
  ) %&gt;%
  # Create a plot with life expectancy over obesity
  ggplot(aes(x=pct.obese, life.exp, color=sex))+geom_point()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="uncounting-observations" class="section level2">
<h2>2-11 Uncounting observations</h2>
<p>You’ve found the job of your dreams providing technical support for a dog breed beauty contest. The jury members want a spreadsheet with the breed and id of each participating dog so that they can add the scores later on. You’ve only been given the number of participants per dog breed (dog_df) so you decide to use your tidyr skills to create the desired result.</p>
<pre class="r"><code>dog_df</code></pre>
<pre><code>## # A tibble: 4 x 2
##   breed            n_participants
##   &lt;chr&gt;                     &lt;dbl&gt;
## 1 Husky                         5
## 2 Golden retriever             12
## 3 Poodle                       13
## 4 Shiba Inu                     7</code></pre>
<pre class="r"><code>dog_df %&gt;% 
  # Create one row for each participant and add the id
  uncount(n_participants, .id = &quot;dog_id&quot;)</code></pre>
<pre><code>## # A tibble: 37 x 2
##    breed            dog_id
##    &lt;chr&gt;             &lt;int&gt;
##  1 Husky                 1
##  2 Husky                 2
##  3 Husky                 3
##  4 Husky                 4
##  5 Husky                 5
##  6 Golden retriever      1
##  7 Golden retriever      2
##  8 Golden retriever      3
##  9 Golden retriever      4
## 10 Golden retriever      5
## # ... with 27 more rows</code></pre>
</div>
<div id="soviet-space-dogs-the-flight-perspective" class="section level2">
<h2>2-13 Soviet space dogs, the flight perspective</h2>
<p>Remember the USSR space dogs dataset1? You changed it to a long format so that for every dog in every rocket launch, there was a row. Suppose you’re given this tidy dataset and are asked to answer the question, “In what percentage of flights were both dogs of the same gender?”</p>
<p>You’ll reshape and investigate space_dogs_df to find the answer.</p>
<pre class="r"><code>space_dogs_df2</code></pre>
<pre><code>## # A tibble: 81 x 3
##    date      gender dog_id
##    &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;
##  1 7/22/1951 Male        1
##  2 7/22/1951 Male        2
##  3 7/29/1951 Male        1
##  4 7/29/1951 Female      2
##  5 8/15/1951 Male        1
##  6 8/15/1951 Male        2
##  7 8/19/1951 Male        1
##  8 8/19/1951 Male        2
##  9 8/28/1951 Male        1
## 10 8/28/1951 Male        2
## # ... with 71 more rows</code></pre>
<pre class="r"><code>space_dogs_df2 %&gt;% 
  # Pivot the data to a wider format
  pivot_wider(names_from = dog_id, values_from = gender, names_prefix = &quot;gender_&quot;)</code></pre>
<pre><code>## # A tibble: 42 x 3
##    date      gender_1 gender_2
##    &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;   
##  1 7/22/1951 Male     Male    
##  2 7/29/1951 Male     Female  
##  3 8/15/1951 Male     Male    
##  4 8/19/1951 Male     Male    
##  5 8/28/1951 Male     Male    
##  6 9/3/1951  Male     Male    
##  7 6/26/1951 Female   Male    
##  8 7/2/1954  Female   Male    
##  9 7/7/1954  Female   Male    
## 10 7/26/1954 Female   Male    
## # ... with 32 more rows</code></pre>
<pre class="r"><code>space_dogs_df2 %&gt;% 
  # Pivot the data to a wider format
  pivot_wider(names_from = dog_id, values_from = gender, names_prefix = &quot;gender_&quot;) %&gt;% 
  # Drop rows with NA values
  drop_na() %&gt;% 
  # Create a Boolean column on whether both dogs have the same gender
  mutate(same_gender= ifelse(gender_1 == gender_2, 1, 0)) %&gt;% 
  summarize(pct_same_gender = mean(same_gender))</code></pre>
<pre><code>## # A tibble: 1 x 1
##   pct_same_gender
##             &lt;dbl&gt;
## 1           0.795</code></pre>
</div>
<div id="planet-temperature-distance-to-the-sun" class="section level2">
<h2>2-14 Planet temperature &amp; distance to the Sun</h2>
<p>The intensity of light radiated by a light source follows an inverse square relationship with the distance it has traveled.</p>
<p><a href="https://en.wikipedia.org/wiki/Inverse-square_law" class="uri">https://en.wikipedia.org/wiki/Inverse-square_law</a></p>
<p>You wonder if you could observe this trend in the temperature of the planets in our Solar System given their distance to the Sun. You’ll use the planet_df dataset from the devstronomy project to investigate this.</p>
<pre class="r"><code>planet_df</code></pre>
<pre><code>## # A tibble: 24 x 3
##    planet  metric            value
##    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;
##  1 Mercury diameter         4879  
##  2 Mercury distance_to_sun    57.9
##  3 Mercury temperature       167  
##  4 Venus   diameter        12104  
##  5 Venus   distance_to_sun   108. 
##  6 Venus   temperature       464  
##  7 Earth   diameter        12756  
##  8 Earth   distance_to_sun   150. 
##  9 Earth   temperature        15  
## 10 Mars    diameter         6792  
## # ... with 14 more rows</code></pre>
<pre class="r"><code>r &lt;- planet_df %&gt;% 
  # Give each planet variable its own column
  pivot_wider(names_from = metric, values_from = value)

r</code></pre>
<pre><code>## # A tibble: 8 x 4
##   planet  diameter distance_to_sun temperature
##   &lt;chr&gt;      &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;
## 1 Mercury     4879            57.9         167
## 2 Venus      12104           108.          464
## 3 Earth      12756           150.           15
## 4 Mars        6792           228.          -65
## 5 Jupiter   142984           779.         -110
## 6 Saturn    120536          1434.         -140
## 7 Uranus     51118          2872.         -195
## 8 Neptune    49528          4495.         -200</code></pre>
<pre class="r"><code>r %&gt;% 
  # Plot planet temperature over distance to sun
  ggplot(aes(distance_to_sun, temperature)) +
  geom_point(aes(size = diameter)) +
  geom_text(aes(label = planet), vjust = -1) +
  labs(x = &quot;Distance to sun (million km)&quot;, 
       y = &quot;Mean temperature (°C)&quot;) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>
<div id="transposing-planet-data" class="section level2">
<h2>2-15 Transposing planet data</h2>
<p>You’re again working on a planet dataset derived from the devstronomy project. This time, you’re interested in the correlation between the diameter of a planet and the number of moons circling it.</p>
<p>However, the dataset (planet_df) has a row for each variable and a column for each planet (observation). You’ll transpose this data in two steps and then create a plot to inspect the correlation.</p>
<pre class="r"><code>planet_df2 %&gt;%
  # Pivot all columns except metric to long format
  pivot_longer(-metric, names_to = &quot;planet&quot;) %&gt;% 
  # Put each metric in its own column
  pivot_wider(names_from = metric, values_from = value) %&gt;% 
  # Plot the number of moons vs planet diameter
  ggplot(aes(diameter, number_of_moons)) +
  geom_point(aes(size = diameter)) +
  geom_text(aes(label = planet), vjust = -1) +
  labs(x = &quot;Diameter (km)&quot;, y = &quot;Number of moons&quot;) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
<div id="expanding-data" class="section level2">
<h2>3- Expanding data</h2>
<p>Values can often be missing in your data, and sometimes entire observations are absent too. In this chapter, you’ll learn how to complete your dataset with these missing observations. You’ll add observations with zero values to counted data, expand time series to a full sequence of intervals, and more!</p>
</div>
<div id="letters-of-the-genetic-code" class="section level2">
<h2>3-2 Letters of the genetic code</h2>
<p>The basic building blocks of RNA are four molecules described by a single letter each: adenine (A), cytosine (C), guanine (G), and uracil (U). The information carried by an RNA strand can be represented as a long sequence of these four letters. To read this code, one has to divide this chain into sequences of three letters each (e.g. GCU, ACG, …). These three letter sequences are known as codons. The concept is illustrated in the image below.</p>
<p>RNA code</p>
<p>Your goal for this exercise is to create a data frame with all possible three letter sequences (codons) from a vector with the four letters representing the RNA building blocks.</p>
<pre class="r"><code>letters &lt;- c(&quot;A&quot;, &quot;C&quot;, &quot;G&quot;, &quot;U&quot;)

# Create a tibble with all possible 3 way combinations
codon_df &lt;- expand_grid(
  letter1 = letters,
  letter2 = letters,
  letter3 = letters
)

codon_df %&gt;% 
  # Unite these three columns into a &quot;codon&quot; column
  unite(&quot;codon&quot;, letter1, letter2, letter3, sep = &quot; &quot;)</code></pre>
<pre><code>## # A tibble: 64 x 1
##    codon
##    &lt;chr&gt;
##  1 A A A
##  2 A A C
##  3 A A G
##  4 A A U
##  5 A C A
##  6 A C C
##  7 A C G
##  8 A C U
##  9 A G A
## 10 A G C
## # ... with 54 more rows</code></pre>
</div>
<div id="when-did-humans-replace-dogs-in-space" class="section level2">
<h2>3-3 When did humans replace dogs in space?</h2>
<p>You already know that in the early days of spaceflight, the USSR was testing rockets with dogs. You now wonder when exactly humans started replacing dogs on space flight missions. You’ve been given a dataset space_df with the number of both dogs (compiled by Duncan Geere) and humans in space per year from 1951 till 1970 (collected from Wikipedia).</p>
<p>Your goal is to create a plot that shows you the number of individuals sent into space per species. Before you can create this plot, you’ll first have to introduce zero values for missing combinations of year and species.</p>
<pre class="r"><code># Create a tibble with all combinations of years and species
full_df &lt;- expand_grid(
    year = 1951:1970,   species = c(&quot;Human&quot;, &quot;Dog&quot;))

full_df</code></pre>
<pre><code>## # A tibble: 40 x 2
##     year species
##    &lt;int&gt; &lt;chr&gt;  
##  1  1951 Human  
##  2  1951 Dog    
##  3  1952 Human  
##  4  1952 Dog    
##  5  1953 Human  
##  6  1953 Dog    
##  7  1954 Human  
##  8  1954 Dog    
##  9  1955 Human  
## 10  1955 Dog    
## # ... with 30 more rows</code></pre>
<pre class="r"><code>space_df %&gt;% 
  # Join with full_df so that missing values are introduced
  right_join(full_df) %&gt;% 
  arrange(year)</code></pre>
<pre><code>## Joining, by = c(&quot;year&quot;, &quot;species&quot;)</code></pre>
<pre><code>## # A tibble: 40 x 3
##     year species n_in_space
##    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1  1951 Dog             14
##  2  1951 Human           NA
##  3  1952 Human           NA
##  4  1952 Dog             NA
##  5  1953 Human           NA
##  6  1953 Dog             NA
##  7  1954 Dog              6
##  8  1954 Human           NA
##  9  1955 Dog              6
## 10  1955 Human           NA
## # ... with 30 more rows</code></pre>
<pre class="r"><code>space_df %&gt;% 
  # Join with full_df so that missing values are introduced
  right_join(full_df) %&gt;% 
  arrange(year)</code></pre>
<pre><code>## # A tibble: 40 x 3
##     year species n_in_space
##    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1  1951 Dog             14
##  2  1951 Human           NA
##  3  1952 Human           NA
##  4  1952 Dog             NA
##  5  1953 Human           NA
##  6  1953 Dog             NA
##  7  1954 Dog              6
##  8  1954 Human           NA
##  9  1955 Dog              6
## 10  1955 Human           NA
## # ... with 30 more rows</code></pre>
<pre class="r"><code># Create a tibble with all combinations of years and species
full_df &lt;- expand_grid(
  year = 1951:1970, 
  species = c(&quot;Human&quot;, &quot;Dog&quot;)
)

space_df %&gt;% 
  # Join with full_df so that missing values are introduced
  right_join(full_df, by = c(&quot;year&quot;, &quot;species&quot;)) %&gt;% 
  # Create a line plot with n_in_space over year, color by species
  ggplot(aes(year, n_in_space, color= species)) +
  geom_line()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<pre class="r"><code># Create a tibble with all combinations of years and species
full_df &lt;- expand_grid(
  year = 1951:1970, 
  species = c(&quot;Human&quot;, &quot;Dog&quot;)
)

space_df %&gt;% 
  # Join with full_df so that missing values are introduced
  right_join(full_df, by = c(&quot;year&quot;, &quot;species&quot;)) %&gt;% 
  # Overwrite NA values for n_in_space with 0L
  replace_na(list(n_in_space = 0L)) %&gt;% 
  # Create a line plot with n_in_space over year, color by species
  ggplot(aes(x = year, y = n_in_space, color = species)) +
  geom_line()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
</div>
<div id="finding-missing-observations" class="section level2">
<h2>3-4 Finding missing observations</h2>
<p>You’re an inspector at a nuclear plant and have to validate whether every reactor has received its daily safety check over the course of a full year. The safety check logs are in reactor_df, a data frame with columns date, reactor, and check.</p>
<p>Two vectors, dates and reactors, with all dates of the year and reactors at the plant respectively have been created for you. You’ll use the combination of the expand_grid() and anti_join() functions to find dates where particular reactors were not checked.</p>
<pre class="r"><code>reactors &lt;- c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;)

# Create a tibble with all combinations of dates and reactors
full_df &lt;- expand_grid(date = dates, reactor = reactors)
full_df</code></pre>
<pre><code>## # A tibble: 1,460 x 2
##    date     reactor
##    &lt;chr&gt;    &lt;chr&gt;  
##  1 1/1/1986 A      
##  2 1/1/1986 B      
##  3 1/1/1986 C      
##  4 1/1/1986 D      
##  5 1/2/1986 A      
##  6 1/2/1986 B      
##  7 1/2/1986 C      
##  8 1/2/1986 D      
##  9 1/3/1986 A      
## 10 1/3/1986 B      
## # ... with 1,450 more rows</code></pre>
<pre class="r"><code># Find the reactor - date combinations not present in reactor_df
full_df %&gt;% 
  anti_join(reactor_df, by = c(&quot;date&quot;, &quot;reactor&quot;))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   date      reactor
##   &lt;chr&gt;     &lt;chr&gt;  
## 1 4/20/1986 B      
## 2 4/22/1986 A      
## 3 4/25/1986 B</code></pre>
</div>
<div id="completing-the-solar-system" class="section level2">
<h2>3-6 Completing the Solar System</h2>
<p>You have been given a data frame (planet_df) from the devstronomy project with the number of moons per planet in our Solar System. However, Mercury and Venus, the two moonless planets, are absent. You want to expand this dataset using the complete() function and a vector planets that contains all eight planet’s names.</p>
<pre class="r"><code>planet_df3</code></pre>
<pre><code>## # A tibble: 8 x 2
##   planet  moons      
##   &lt;chr&gt;   &lt;list&gt;     
## 1 Mercury &lt;NULL&gt;     
## 2 Venus   &lt;NULL&gt;     
## 3 Earth   &lt;list [1]&gt; 
## 4 Jupiter &lt;list [67]&gt;
## 5 Mars    &lt;list [2]&gt; 
## 6 Neptune &lt;list [14]&gt;
## 7 Saturn  &lt;list [61]&gt;
## 8 Uranus  &lt;list [27]&gt;</code></pre>
<pre class="r"><code>planets = c(&quot;Mercury&quot;, &quot;Venus&quot;, &quot;Earth&quot;, &quot;Mars&quot;, &quot;Jupiter&quot;, &quot;Saturn&quot;, &quot;Uranus&quot;, &quot;Neptune&quot;)

planet_df3 %&gt;% 
  complete(
    # Complete the planet variable
    planet=planets,
    # Overwrite NA values for n_moons with 0L
    fill = list(n_moons = 0L)
  )</code></pre>
<pre><code>## # A tibble: 8 x 2
##   planet  moons      
##   &lt;chr&gt;   &lt;list&gt;     
## 1 Earth   &lt;list [1]&gt; 
## 2 Jupiter &lt;list [67]&gt;
## 3 Mars    &lt;list [2]&gt; 
## 4 Mercury &lt;NULL&gt;     
## 5 Neptune &lt;list [14]&gt;
## 6 Saturn  &lt;list [61]&gt;
## 7 Uranus  &lt;list [27]&gt;
## 8 Venus   &lt;NULL&gt;</code></pre>
</div>
<div id="zero-olympic-medals" class="section level2">
<h2>3-7 Zero Olympic medals</h2>
<p>Since 1896, athletes from all over the world have been competing in the modern Olympic games. You’ve been given a dataset (medal_df) with observations for all medals won by athletes from the 10 most successful countries in Olympic history. You want to create a visual with the number of medals won per country (team) per year. However, since not all countries won medals each year, you’ll have to introduce zero values before you can make an accurate visual.</p>
<pre class="r"><code>medal_df2</code></pre>
<pre><code>## # A tibble: 17,137 x 5
##    name                      sport       year medal  team         
##    &lt;chr&gt;                     &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;        
##  1 Edward Battel             Cycling     1896 Bronze Great Britain
##  2 Arthur Charles Blake      Athletics   1896 Silver United States
##  3 Conrad Helmut Fritz Bcker Gymnastics  1896 Gold   Germany      
##  4 Conrad Helmut Fritz Bcker Gymnastics  1896 Gold   Germany      
##  5 John Mary Pius Boland     Tennis      1896 Gold   Great Britain
##  6 Thomas Edmund Burke       Athletics   1896 Gold   United States
##  7 Thomas Edmund Burke       Athletics   1896 Gold   United States
##  8 Eugne Henri Callot        Fencing     1896 Silver France       
##  9 Ellery Harding Clark      Athletics   1896 Gold   United States
## 10 Ellery Harding Clark      Athletics   1896 Gold   United States
## # ... with 17,127 more rows</code></pre>
<pre class="r"><code>medal_df2 %&gt;% 
  # Count the medals won per team and year
  count(team, year, name = &quot;n_medals&quot;) %&gt;% 
  # Plot n_medals over year, colored by team
  ggplot(aes(year, n_medals, color=team)) +
  geom_line() +
  scale_color_brewer(palette = &quot;Paired&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<pre class="r"><code>medal_df2 %&gt;% 
  # Count the medals won per team and year
  count(team, year, name = &quot;n_medals&quot;) %&gt;% 
  # Complete the team and year variables, fill n_medals with zeros
  complete(team , year,
     fill = list(n_medals = 0L)
  ) %&gt;% 
  # Plot n_medals over year, colored by team
  ggplot(aes(x = year, y = n_medals, color = team)) +
  geom_line() +
  scale_color_brewer(palette = &quot;Paired&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
</div>
<div id="creating-a-sequence-with-full_seq" class="section level2">
<h2>3-8 Creating a sequence with full_seq()</h2>
<p>The full_seq() function will look for the minimal and maximal values inside the vector you pass it and will then generate a full sequence of numbers with a fixed period in between them. When used inside the complete() function, full_seq() is a handy tool to make sure there are no missing observations in your data. Before combining these two functions you’ll generate a few sequences with full_seq() on its own to get the hang of this function.</p>
</div>
<div id="the-cold-wars-hottest-year" class="section level2">
<h2>3-9 The Cold War’s hottest year</h2>
<p>In October 1962, during the Cuban missile crisis, the world came close to a full scale nuclear war. Throughout 1962, the USA, USSR, and France together detonated a record 178 nuclear bombs for military power display and research. You’ve been given a sample of the Nuclear Explosion Database (NEDB) for that year (cumul_nukes_1962_df) with an observation for each date on which a bomb was detonated. The total_bombs variable contains the cumulative number of bombs detonated by a country up to that point in time.</p>
<p>You’ll complete the dataset to hold the full sequence of dates, and visualize the total number of bombs per country over time. You’ll also use the fill() function from Chapter One to impute missing values.</p>
<pre class="r"><code>cumul_nukes_1962_df</code></pre>
<pre><code>## # A tibble: 144 x 4
##       X1 country            date       total_bombs
##    &lt;dbl&gt; &lt;chr&gt;              &lt;date&gt;           &lt;dbl&gt;
##  1     1 France             1962-01-01           0
##  2     2 France             1962-05-01           1
##  3     3 Russian Federation 1962-01-01           0
##  4     4 Russian Federation 1962-02-02           1
##  5     5 Russian Federation 1962-08-01           2
##  6     6 Russian Federation 1962-08-03           3
##  7     7 Russian Federation 1962-08-04           4
##  8     8 Russian Federation 1962-08-05           5
##  9     9 Russian Federation 1962-08-07           6
## 10    10 Russian Federation 1962-08-10           7
## # ... with 134 more rows</code></pre>
<pre class="r"><code>cumul_nukes_1962_df %&gt;% 
  # Complete the dataset
  complete(country, date = full_seq(date, period = 1))</code></pre>
<pre><code>## # A tibble: 1,077 x 4
##    country date          X1 total_bombs
##    &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1 France  1962-01-01     1           0
##  2 France  1962-01-02    NA          NA
##  3 France  1962-01-03    NA          NA
##  4 France  1962-01-04    NA          NA
##  5 France  1962-01-05    NA          NA
##  6 France  1962-01-06    NA          NA
##  7 France  1962-01-07    NA          NA
##  8 France  1962-01-08    NA          NA
##  9 France  1962-01-09    NA          NA
## 10 France  1962-01-10    NA          NA
## # ... with 1,067 more rows</code></pre>
<pre class="r"><code>cumul_nukes_1962_df %&gt;% 
  # Complete the dataset
  complete(country, date = full_seq(date, period = 1)) %&gt;% 
  # Group the data by country
  group_by(country) %&gt;% 
  # Impute missing values with the last known observation
  fill(total_bombs)</code></pre>
<pre><code>## # A tibble: 1,077 x 4
## # Groups:   country [3]
##    country date          X1 total_bombs
##    &lt;chr&gt;   &lt;date&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1 France  1962-01-01     1           0
##  2 France  1962-01-02    NA           0
##  3 France  1962-01-03    NA           0
##  4 France  1962-01-04    NA           0
##  5 France  1962-01-05    NA           0
##  6 France  1962-01-06    NA           0
##  7 France  1962-01-07    NA           0
##  8 France  1962-01-08    NA           0
##  9 France  1962-01-09    NA           0
## 10 France  1962-01-10    NA           0
## # ... with 1,067 more rows</code></pre>
<pre class="r"><code>cumul_nukes_1962_df %&gt;% 
  # Complete the dataset
  complete(country, date = full_seq(date, period = 1)) %&gt;% 
  # Group the data by country
  group_by(country) %&gt;% 
  # Impute missing values with the last known observation
  fill(total_bombs) %&gt;% 
  # Plot the number of bombs over time, color by country
  ggplot(aes(date, total_bombs, color=country)) +
  # These two lines will mark the Cuban Missile Crisis 
  geom_rect(xmin = as.Date(&quot;1962-10-16&quot;), xmax = as.Date(&quot;1962-10-29&quot;), ymin = -Inf, ymax = Inf, color = NA)+ 
  geom_text(x = as.Date(&quot;1962-10-22&quot;), y = 15, label = &quot;Cuban Missile Crisis&quot;, angle = 90, color = &quot;white&quot;)+
  geom_line()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="olympic-medals-per-continent" class="section level2">
<h2>3-11 Olympic medals per continent</h2>
<p>You want to compare Olympic performance of athletes per continent over time, both on the winter and summer Olympics. You’ve been given a dataset medal_df with the average number of medals won per participant of each continent since 1928. You’ll complete this data to introduce zero values for years where a continent did not win any medals.</p>
<pre class="r"><code>medal_df</code></pre>
<pre><code>## # A tibble: 187 x 4
##    continent season  year medals_per_participant
##    &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Africa    Summer  1928                 0.172 
##  2 Africa    Summer  1932                 0.417 
##  3 Africa    Summer  1936                 0.0706
##  4 Africa    Summer  1948                 0.0917
##  5 Africa    Summer  1952                 0.0806
##  6 Africa    Summer  1956                 0.0654
##  7 Africa    Summer  1960                 0.0256
##  8 Africa    Summer  1964                 0.0209
##  9 Africa    Summer  1968                 0.0717
## 10 Africa    Summer  1972                 0.0477
## # ... with 177 more rows</code></pre>
<pre class="r"><code>medal_df %&gt;% 
  # Give each continent an observation at each Olympic event
  complete(
    continent, 
    nesting(season, year), 
    fill = list(medals_per_participant = 0)
  ) %&gt;%
  # Plot the medals_per_participant over time, colored by continent
  ggplot(aes(x = year, y = medals_per_participant, color = continent)) +
  geom_line() +
  facet_grid(season ~ .)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
</div>
<div id="tracking-a-virus-outbreak" class="section level2">
<h2>3-12 Tracking a virus outbreak</h2>
<p>You’re a doctor in a remote village confronted with a virus outbreak. You have been collecting data on when your patients got infected and recovered in a data frame named patient_df. Your goal is to create a visual with the number of sick patients over time. You’ll first have to reshape the data so that you can count the number of sick patients per day.</p>
<pre class="r"><code>patient_df %&gt;% 
  # Pivot the infected and recovered columns to long format
  pivot_longer(c(infected, recovered), names_to= &quot;status&quot;, values_to= &quot;date&quot;)</code></pre>
<pre><code>## # A tibble: 52 x 3
##    patient status    date      
##    &lt;chr&gt;   &lt;chr&gt;     &lt;date&gt;    
##  1 A       infected  2020-02-08
##  2 A       recovered 2020-03-28
##  3 B       infected  2020-02-19
##  4 B       recovered 2020-03-04
##  5 C       infected  2020-02-27
##  6 C       recovered 2020-03-19
##  7 D       infected  2020-03-05
##  8 D       recovered 2020-03-19
##  9 E       infected  2020-03-06
## 10 E       recovered 2020-03-29
## # ... with 42 more rows</code></pre>
<pre class="r"><code>patient_df</code></pre>
<pre><code>## # A tibble: 26 x 3
##    patient infected   recovered 
##    &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;    
##  1 A       2020-02-08 2020-03-28
##  2 B       2020-02-19 2020-03-04
##  3 C       2020-02-27 2020-03-19
##  4 D       2020-03-05 2020-03-19
##  5 E       2020-03-06 2020-03-29
##  6 F       2020-03-07 2020-03-22
##  7 G       2020-03-07 2020-03-28
##  8 H       2020-03-08 2020-04-01
##  9 I       2020-03-09 2020-05-02
## 10 J       2020-03-11 2020-03-30
## # ... with 16 more rows</code></pre>
<pre class="r"><code>patient_df %&gt;% 
  # Pivot the infected and recovered columns to long format
  pivot_longer(-patient, names_to = &quot;status&quot;, values_to = &quot;date&quot;) %&gt;% 
  select(-status) %&gt;% 
  # Group by patient
  group_by(patient) %&gt;% 
  # Complete the date range per patient using full_seq()
  complete(date = full_seq(date, 1)) %&gt;% 
  # Ungroup the data
  ungroup()</code></pre>
<pre><code>## # A tibble: 684 x 2
##    patient date      
##    &lt;chr&gt;   &lt;date&gt;    
##  1 A       2020-02-08
##  2 A       2020-02-09
##  3 A       2020-02-10
##  4 A       2020-02-11
##  5 A       2020-02-12
##  6 A       2020-02-13
##  7 A       2020-02-14
##  8 A       2020-02-15
##  9 A       2020-02-16
## 10 A       2020-02-17
## # ... with 674 more rows</code></pre>
<pre class="r"><code>patient_df %&gt;% 
  # Pivot the infected and recovered columns to long format
  pivot_longer(-patient, names_to = &quot;status&quot;, values_to = &quot;date&quot;) %&gt;% 
  select(-status) %&gt;% 
  # Group by patient
  group_by(patient) %&gt;% 
  # Complete the date range per patient using full_seq()
  complete(date = full_seq(date, period = 1)) %&gt;% 
  # Ungroup the data
  ungroup() %&gt;% 
  # Count the dates, the count goes in the n_sick variable
  count(date, name = &quot;n_sick&quot;) %&gt;% 
  ggplot(aes(x = date, y = n_sick))+
  geom_line()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
</div>
<div id="counting-office-occupants" class="section level2">
<h2>3-13 Counting office occupants</h2>
<p>Imagine you’re an office facility manager and want to know how many people are present throughout the day. You’ve installed a sensor at the entrance that counts the number of people entering and leaving the building. The sensor sends an update at the end of every 20 minute time slot if at least one person passed.</p>
<p>To create a dataset ready for visualization, you’ll combine the different techniques you’ve learned so far.</p>
<hr />
<p>sensor_df</p>
<p>sensor_df %&gt;%
# Complete the time column with a 20 minute interval
complete(time = seq(from = min(time), to = max(time), by = “20 min”),
fill = list(enter = 0L, exit = 0L))</p>
<p>sensor_df %&gt;%
# Complete the time column with a 20 minute interval
complete(time = seq(min(time), max(time), by = “20 min”),
fill = list(enter = 0L, exit = 0L)) %&gt;%
# Calculate the total number of people inside
mutate(total_inside = cumsum(enter + exit))</p>
<p>sensor_df %&gt;%
# Complete the time column with a 20 minute interval
complete(time = seq(min(time), max(time), by = “20 min”),
fill = list(enter = 0L, exit = 0L)) %&gt;%
# Calculate the total number of people inside
mutate(total_inside = cumsum(enter + exit)) %&gt;%
# Pivot the enter and exit columns to long format
pivot_longer(enter:exit, names_to = “direction”, values_to = “n_people”)</p>
<p>sensor_df %&gt;%
# Complete the time column with a 20 minute interval
complete(time = seq(min(time), max(time), by = “20 min”),
fill = list(enter = 0L, exit = 0L)) %&gt;%
# Calculate the total number of people inside
mutate(total_inside = cumsum(enter + exit)) %&gt;%
# Pivot the enter and exit columns to long format
pivot_longer(enter:exit, names_to = “direction”, values_to = “n_people”) %&gt;%
# Plot the number of people over time, fill by direction
ggplot(aes(x = time, y = n_people, fill = direction)) +
geom_area() +
geom_line(aes(y = total_inside))</p>
<hr />
</div>
<div id="rectangling-data" class="section level2">
<h2>4- Rectangling data</h2>
<p>In the final chapter, you’ll learn how to turn nested data structures such as JSON and XML files into tidy, rectangular data. This skill will enable you to process data from web APIs. You’ll also learn how nested data structures can be used to write elegant modeling pipelines that produce tidy outputs.</p>
</div>
<div id="rectangling-star-wars-movies" class="section level2">
<h2>4-3 Rectangling Star Wars movies</h2>
<p>Let’s pretend you’re a big Star Wars fan and decided to scrape some data from the Star Wars API. You’ve already loaded the JSON-formatted response into R, and now have two lists of movies named movie_list and movie_planets_list. Your goal is to turn these into rectangular data frames with one row per movie so that you can start crunching those movie stats.</p>
<pre class="r"><code>movie_list</code></pre>
<pre><code>## [[1]]
## [[1]]$title
## [1] &quot;A New Hope&quot;
## 
## [[1]]$episode_id
## [1] 4
## 
## [[1]]$release_date
## [1] &quot;1977-05-25&quot;
## 
## [[1]]$director
## [1] &quot;George Lucas&quot;
## 
## [[1]]$producer
## [1] &quot;Gary Kurtz, Rick McCallum&quot;
## 
## 
## [[2]]
## [[2]]$title
## [1] &quot;Attack of the Clones&quot;
## 
## [[2]]$episode_id
## [1] 2
## 
## [[2]]$release_date
## [1] &quot;2002-05-16&quot;
## 
## [[2]]$director
## [1] &quot;George Lucas&quot;
## 
## [[2]]$producer
## [1] &quot;Rick McCallum&quot;
## 
## 
## [[3]]
## [[3]]$title
## [1] &quot;The Phantom Menace&quot;
## 
## [[3]]$episode_id
## [1] 1
## 
## [[3]]$release_date
## [1] &quot;1999-05-19&quot;
## 
## [[3]]$director
## [1] &quot;George Lucas&quot;
## 
## [[3]]$producer
## [1] &quot;Rick McCallum&quot;
## 
## 
## [[4]]
## [[4]]$title
## [1] &quot;Revenge of the Sith&quot;
## 
## [[4]]$episode_id
## [1] 3
## 
## [[4]]$release_date
## [1] &quot;2005-05-19&quot;
## 
## [[4]]$director
## [1] &quot;George Lucas&quot;
## 
## [[4]]$producer
## [1] &quot;Rick McCallum&quot;
## 
## 
## [[5]]
## [[5]]$title
## [1] &quot;Return of the Jedi&quot;
## 
## [[5]]$episode_id
## [1] 6
## 
## [[5]]$release_date
## [1] &quot;1983-05-25&quot;
## 
## [[5]]$director
## [1] &quot;Richard Marquand&quot;
## 
## [[5]]$producer
## [1] &quot;Howard G. Kazanjian, George Lucas, Rick McCallum&quot;
## 
## 
## [[6]]
## [[6]]$title
## [1] &quot;The Empire Strikes Back&quot;
## 
## [[6]]$episode_id
## [1] 5
## 
## [[6]]$release_date
## [1] &quot;1980-05-17&quot;
## 
## [[6]]$director
## [1] &quot;Irvin Kershner&quot;
## 
## [[6]]$producer
## [1] &quot;Gary Kurtz, Rick McCallum&quot;
## 
## 
## [[7]]
## [[7]]$title
## [1] &quot;The Force Awakens&quot;
## 
## [[7]]$episode_id
## [1] 7
## 
## [[7]]$release_date
## [1] &quot;2015-12-11&quot;
## 
## [[7]]$director
## [1] &quot;J. J. Abrams&quot;
## 
## [[7]]$producer
## [1] &quot;Kathleen Kennedy, J. J. Abrams, Bryan Burk&quot;</code></pre>
<pre class="r"><code>##############################
movie_planets_list</code></pre>
<pre><code>## [[1]]
## [[1]]$title
## [1] &quot;A New Hope&quot;
## 
## [[1]]$release_date
## [1] &quot;1977-05-25&quot;
## 
## [[1]]$planets
## [1] &quot;Alderaan&quot; &quot;Yavin IV&quot; &quot;Tatooine&quot;
## 
## 
## [[2]]
## [[2]]$title
## [1] &quot;The Empire Strikes Back&quot;
## 
## [[2]]$release_date
## [1] &quot;1980-05-17&quot;
## 
## [[2]]$planets
## [1] &quot;Hoth&quot;        &quot;Dagobah&quot;     &quot;Bespin&quot;      &quot;Ord Mantell&quot;
## 
## 
## [[3]]
## [[3]]$title
## [1] &quot;Return of the Jedi&quot;
## 
## [[3]]$release_date
## [1] &quot;1983-05-25&quot;
## 
## [[3]]$planets
## [1] &quot;Dagobah&quot;   &quot;Endor&quot;     &quot;Naboo&quot;     &quot;Coruscant&quot; &quot;Tatooine&quot; 
## 
## 
## [[4]]
## [[4]]$title
## [1] &quot;The Phantom Menace&quot;
## 
## [[4]]$release_date
## [1] &quot;1999-05-19&quot;
## 
## [[4]]$planets
## [1] &quot;Naboo&quot;     &quot;Coruscant&quot; &quot;Tatooine&quot; 
## 
## 
## [[5]]
## [[5]]$title
## [1] &quot;Attack of the Clones&quot;
## 
## [[5]]$release_date
## [1] &quot;2002-05-16&quot;
## 
## [[5]]$planets
## [1] &quot;Naboo&quot;     &quot;Coruscant&quot; &quot;Kamino&quot;    &quot;Geonosis&quot;  &quot;Tatooine&quot; 
## 
## 
## [[6]]
## [[6]]$title
## [1] &quot;Revenge of the Sith&quot;
## 
## [[6]]$release_date
## [1] &quot;2005-05-19&quot;
## 
## [[6]]$planets
##  [1] &quot;Alderaan&quot;       &quot;Dagobah&quot;        &quot;Naboo&quot;          &quot;Coruscant&quot;     
##  [5] &quot;Utapau&quot;         &quot;Mustafar&quot;       &quot;Kashyyyk&quot;       &quot;Polis Massa&quot;   
##  [9] &quot;Mygeeto&quot;        &quot;Felucia&quot;        &quot;Cato Neimoidia&quot; &quot;Saleucami&quot;     
## [13] &quot;Tatooine&quot;      
## 
## 
## [[7]]
## [[7]]$title
## [1] &quot;The Force Awakens&quot;
## 
## [[7]]$release_date
## [1] &quot;2015-12-11&quot;
## 
## [[7]]$planets
## [1] &quot;Jakku&quot;</code></pre>
<pre class="r"><code># Create a movie column from the movie_list
tibble(movie = movie_list) %&gt;% 
  # Unnest the movie column
  unnest_wider(movie)</code></pre>
<pre><code>## # A tibble: 7 x 5
##   title          episode_id release_date director     producer                  
##   &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;                     
## 1 A New Hope              4 1977-05-25   George Lucas Gary Kurtz, Rick McCallum 
## 2 Attack of the~          2 2002-05-16   George Lucas Rick McCallum             
## 3 The Phantom M~          1 1999-05-19   George Lucas Rick McCallum             
## 4 Revenge of th~          3 2005-05-19   George Lucas Rick McCallum             
## 5 Return of the~          6 1983-05-25   Richard Mar~ Howard G. Kazanjian, Geor~
## 6 The Empire St~          5 1980-05-17   Irvin Kersh~ Gary Kurtz, Rick McCallum 
## 7 The Force Awa~          7 2015-12-11   J. J. Abrams Kathleen Kennedy, J. J. A~</code></pre>
<pre class="r"><code># Create a tibble with a movie column
tibble(movie = movie_planets_list) %&gt;% 
  # Unnest the movie column
  unnest_wider(movie) %&gt;% 
  # Unnest the planets column
  unnest_wider(planets)</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1
## * `` -&gt; ...2
## * `` -&gt; ...3</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1
## * `` -&gt; ...2
## * `` -&gt; ...3
## * `` -&gt; ...4</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1
## * `` -&gt; ...2
## * `` -&gt; ...3
## * `` -&gt; ...4
## * `` -&gt; ...5</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1
## * `` -&gt; ...2
## * `` -&gt; ...3</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1
## * `` -&gt; ...2
## * `` -&gt; ...3
## * `` -&gt; ...4
## * `` -&gt; ...5</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1
## * `` -&gt; ...2
## * `` -&gt; ...3
## * `` -&gt; ...4
## * `` -&gt; ...5
## * ...</code></pre>
<pre><code>## New names:
## * `` -&gt; ...1</code></pre>
<pre><code>## # A tibble: 7 x 15
##   title release_date ...1  ...2  ...3  ...4  ...5  ...6  ...7  ...8  ...9  ...10
##   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 A Ne~ 1977-05-25   Alde~ Yavi~ Tato~ &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 2 The ~ 1980-05-17   Hoth  Dago~ Besp~ Ord ~ &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 3 Retu~ 1983-05-25   Dago~ Endor Naboo Coru~ Tato~ &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 4 The ~ 1999-05-19   Naboo Coru~ Tato~ &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 5 Atta~ 2002-05-16   Naboo Coru~ Kami~ Geon~ Tato~ &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 6 Reve~ 2005-05-19   Alde~ Dago~ Naboo Coru~ Utap~ Must~ Kash~ Poli~ Myge~ Felu~
## 7 The ~ 2015-12-11   Jakku &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## # ... with 3 more variables: ...11 &lt;chr&gt;, ...12 &lt;chr&gt;, ...13 &lt;chr&gt;</code></pre>
</div>
<div id="rectangling-star-wars-planets" class="section level2">
<h2>4-6 Rectangling Star Wars planets</h2>
<p>Let’s finish what we started in the last exercise of the previous lesson, exploring Star Wars planets! The movie_planets_list scraped from the Star Wars API has been pre-loaded for you. You’ll need two specific unnesting operations to completely rectangle this data.</p>
<pre class="r"><code>movie_planets_list</code></pre>
<pre><code>## [[1]]
## [[1]]$title
## [1] &quot;A New Hope&quot;
## 
## [[1]]$release_date
## [1] &quot;1977-05-25&quot;
## 
## [[1]]$planets
## [1] &quot;Alderaan&quot; &quot;Yavin IV&quot; &quot;Tatooine&quot;
## 
## 
## [[2]]
## [[2]]$title
## [1] &quot;The Empire Strikes Back&quot;
## 
## [[2]]$release_date
## [1] &quot;1980-05-17&quot;
## 
## [[2]]$planets
## [1] &quot;Hoth&quot;        &quot;Dagobah&quot;     &quot;Bespin&quot;      &quot;Ord Mantell&quot;
## 
## 
## [[3]]
## [[3]]$title
## [1] &quot;Return of the Jedi&quot;
## 
## [[3]]$release_date
## [1] &quot;1983-05-25&quot;
## 
## [[3]]$planets
## [1] &quot;Dagobah&quot;   &quot;Endor&quot;     &quot;Naboo&quot;     &quot;Coruscant&quot; &quot;Tatooine&quot; 
## 
## 
## [[4]]
## [[4]]$title
## [1] &quot;The Phantom Menace&quot;
## 
## [[4]]$release_date
## [1] &quot;1999-05-19&quot;
## 
## [[4]]$planets
## [1] &quot;Naboo&quot;     &quot;Coruscant&quot; &quot;Tatooine&quot; 
## 
## 
## [[5]]
## [[5]]$title
## [1] &quot;Attack of the Clones&quot;
## 
## [[5]]$release_date
## [1] &quot;2002-05-16&quot;
## 
## [[5]]$planets
## [1] &quot;Naboo&quot;     &quot;Coruscant&quot; &quot;Kamino&quot;    &quot;Geonosis&quot;  &quot;Tatooine&quot; 
## 
## 
## [[6]]
## [[6]]$title
## [1] &quot;Revenge of the Sith&quot;
## 
## [[6]]$release_date
## [1] &quot;2005-05-19&quot;
## 
## [[6]]$planets
##  [1] &quot;Alderaan&quot;       &quot;Dagobah&quot;        &quot;Naboo&quot;          &quot;Coruscant&quot;     
##  [5] &quot;Utapau&quot;         &quot;Mustafar&quot;       &quot;Kashyyyk&quot;       &quot;Polis Massa&quot;   
##  [9] &quot;Mygeeto&quot;        &quot;Felucia&quot;        &quot;Cato Neimoidia&quot; &quot;Saleucami&quot;     
## [13] &quot;Tatooine&quot;      
## 
## 
## [[7]]
## [[7]]$title
## [1] &quot;The Force Awakens&quot;
## 
## [[7]]$release_date
## [1] &quot;2015-12-11&quot;
## 
## [[7]]$planets
## [1] &quot;Jakku&quot;</code></pre>
<pre class="r"><code># Create a tibble from movie_planets_list
tibble(movie = movie_planets_list) %&gt;% 
  # Unnest the movie column in the correct direction
  unnest_wider(movie) %&gt;% 
  # Unnest the planets column in the correct direction
  unnest_longer(planets)</code></pre>
<pre><code>## # A tibble: 34 x 3
##    title                   release_date planets    
##    &lt;chr&gt;                   &lt;chr&gt;        &lt;chr&gt;      
##  1 A New Hope              1977-05-25   Alderaan   
##  2 A New Hope              1977-05-25   Yavin IV   
##  3 A New Hope              1977-05-25   Tatooine   
##  4 The Empire Strikes Back 1980-05-17   Hoth       
##  5 The Empire Strikes Back 1980-05-17   Dagobah    
##  6 The Empire Strikes Back 1980-05-17   Bespin     
##  7 The Empire Strikes Back 1980-05-17   Ord Mantell
##  8 Return of the Jedi      1983-05-25   Dagobah    
##  9 Return of the Jedi      1983-05-25   Endor      
## 10 Return of the Jedi      1983-05-25   Naboo      
## # ... with 24 more rows</code></pre>
</div>
<div id="the-solar-systems-biggest-moons" class="section level2">
<h2>4-7 The Solar System’s biggest moons</h2>
<p>Most planets in our solar system are accompanied by at least one moon. You now wonder which planets are circled by the biggest moons and want to create a top five based on moon radius. However, you’ll first have to unnest the devstronomy project data in planet_df using the unnest_longer() and unnest_wider() functions.</p>
<pre class="r"><code>planet_df3</code></pre>
<pre><code>## # A tibble: 8 x 2
##   planet  moons      
##   &lt;chr&gt;   &lt;list&gt;     
## 1 Mercury &lt;NULL&gt;     
## 2 Venus   &lt;NULL&gt;     
## 3 Earth   &lt;list [1]&gt; 
## 4 Jupiter &lt;list [67]&gt;
## 5 Mars    &lt;list [2]&gt; 
## 6 Neptune &lt;list [14]&gt;
## 7 Saturn  &lt;list [61]&gt;
## 8 Uranus  &lt;list [27]&gt;</code></pre>
<pre class="r"><code>planet_df3 %&gt;% 
  # Unnest the moons list column over observations
  unnest_longer(moons) %&gt;% 
  # Further unnest the moons column
  unnest_wider(moons) %&gt;% 
  # Unnest the moon_data column
  unnest_wider(moon_data) %&gt;% 
  # Get the top five largest moons by radius
  slice_max(radius, n = 5)</code></pre>
<pre><code>## # A tibble: 5 x 4
##   planet  moon_name radius density
##   &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
## 1 Jupiter Ganymede   2631.    1.94
## 2 Saturn  Titan      2575.    1.88
## 3 Jupiter Callisto   2410.    1.83
## 4 Jupiter Io         1822.    3.53
## 5 Earth   Moon       1738.    3.34</code></pre>
</div>
<div id="hoisting-star-wars-films" class="section level2">
<h2>4-9 Hoisting Star Wars films</h2>
<p>You’ve been given a nested data set on Star Wars characters (character_df) and want to explore the films in which they appeared. You’ll first use the unnest_wider() and unnest_longer() functions to explore the data and will then switch to hoist() to select a specific element in the nested data structure directly.</p>
</div>
<div id="hoisting-movie-ratings" class="section level2">
<h2>4-10 Hoisting movie ratings</h2>
<p>You’ve written a script to scrape data on your favorite movies from the Open Movie DataBase API. Now you want to process the JSON data to extract the Rotten Tomatoes rating for each movie. You’ve been given a data frame named movie_df which holds the JSON respones for five movies. You’ll explore this data with unnest_wider() and unnest_longer() before switching to hoist().</p>
</div>
<div id="nesting-tibbles" class="section level2">
<h2>4-13 Nesting tibbles</h2>
<p>You’re pre-processing the US army body measurement dataset ANSUR II to train multiple models in a single pipeline. You’ll experiment with the nest() function to create a list column with nested tibbles containing sub-sets of the data.</p>
</div>
<div id="modeling-on-nested-data-frames" class="section level2">
<h2>4-14 Modeling on nested data frames</h2>
<p>You’ll be working on the US Army ANSUR II body measurement dataset, which has been pre-loaded as ansur_df. The goal is to nest the data for both sexes so that you can simultaneously train two linear models, one for each sex. These models will derive a person’s weight from their stature (height) and waist circumference. You’ll then unnest the data to inspect the model’s statistics produced by the glance() function from the broom package.</p>
<p>The dplyr, broom, and purrr packages have been pre-loaded for you.</p>
<p>Side note: In the provided code, the purrr package’s map() function applies functions on each nested data frame. Check out this package if you like using functions inside pipes!</p>
<pre class="r"><code>ansur_df %&gt;%
  # Group the data by sex
  group_by(sex) %&gt;% 
  # Nest the data
  nest() %&gt;%
  mutate(
    fit = map(data, function(df) lm(weight_kg ~ waist_circum_m + stature_m, data = df)),
    glanced = map(fit, glance)
  ) %&gt;% 
  # Unnest the glanced column
  unnest(glanced)</code></pre>
<pre><code>## # A tibble: 2 x 15
## # Groups:   sex [2]
##   sex    data        fit   r.squared adj.r.squared sigma statistic p.value    df
##   &lt;chr&gt;  &lt;list&gt;      &lt;lis&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 Female &lt;tibble [1~ &lt;lm&gt;      0.822         0.822  4.63     4585.       0     2
## 2 Male   &lt;tibble [4~ &lt;lm&gt;      0.873         0.873  5.06    14076.       0     2
## # ... with 6 more variables: logLik &lt;dbl&gt;, AIC &lt;dbl&gt;, BIC &lt;dbl&gt;,
## #   deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
